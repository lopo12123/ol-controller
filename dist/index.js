import{create_tile_map__xyz as e,create_point_layer as t,create_point_cluster_layer as a,create_polygon_layer__GeoJson as s,create_polygon_layer__PathArray as r,create_polyline_layer as o}from"./core.js";import{AnimationController as l}from"./animation.js";import{PopupController as i}from"./popup.js";import{Select as n}from"ol/interaction";import{getTopRight as h}from"ol/extent";import"ol/ol.css";import"ol";import"ol/layer/Tile";import"ol/source";import"ol/layer/Vector";import"ol/source/Vector";import"ol/format";import"ol/style";import"ol/geom";import"ol/proj";import"ol/style/Circle";import"ol/layer/Image";import"ol/render";class p{#e;get dom(){return this.#e}#t=null;get map(){return this.#t}get instantiated(){return null!==this.#t}enable_select_listener(){const e=new n;e.on("select",(e=>{const t=e.target?.getFeatures()?.getArray()?.[0];if(t){const e=h(t.getGeometry().getExtent());t.getProperties()._click_callback?.(e)}e.target?.getFeatures()?.clear()})),this.#t?.addInteraction(e)}constructor(t,a){this.#e=t,this.#t=e(t,a),this.enable_select_listener()}render(t,a){null!==this.#t&&(console.warn('[OlController] There is a map instance on the target dom, calling the method "render" will overwrite the old map instance. If that`s what you`re doing, ignore this warning.'),this.dispose()),this.#e=t,this.#t=e(t,a),this.enable_select_listener()}zoom(e){const t=this.#t?.getView(),a=t?.getZoom();t&&a&&("-"===e?t.setZoom(a-1):"+"===e?t.setZoom(a+1):t.setZoom(e))}getZoomLevel(){return this.#t?.getView().getZoom()??null}searchInLayer(e,t){const a=this.#a.get(e);if(a){const e=a.getSource().getFeatures();for(let a=0;a<e.length;a++){const s=e[a].getProperties().self;if(t(s))return s.extData??null}}return null}toggle_visible(e,t){const a=this.#a.get(e);a&&a.setVisible(t??!a.getVisible())}#a=new Map;get layers(){return[...this.#a.keys()]}getLayer(e){return this.#a.get(e)}addPointLayer(e,a,s,r){if(this.#t){this.#a.has(e)&&console.warn(`[OlController] A layer named "${e}" already exists, the old layer will be replaced by the new layer. If that's what you're doing, ignore this warning.`);const o=t(a,s,r);this.#a.set(e,o),this.#t.addLayer(o)}else console.warn("[OlController] The map instance has already disposed.")}addPointClusterLayer(e,t,s,r,o,l,i){if(this.#t){this.#a.has(e)&&console.warn(`[OlController] A layer named "${e}" already exists, the old layer will be replaced by the new layer. If that's what you're doing, ignore this warning.`);const n=a(t,s,r,o,l,i);this.#a.set(e,n),this.#t.addLayer(n)}else console.warn("[OlController] The map instance has already disposed.")}addPolygonLayer(e,t,a,o){if(this.#t)if(this.#a.has(e)&&console.warn(`[OlController] A layer named "${e}" already exists, the old layer will be replaced by the new layer. If that's what you're doing, ignore this warning.`),"string"==typeof t){const r=s(t,a);this.#a.set(e,r),this.#t.addLayer(r)}else{const s=r(t,a,o);this.#a.set(e,s),this.#t.addLayer(s)}else console.warn("[OlController] The map instance has already disposed.")}addPolylineLayer(e,t,a,s){if(this.#t){this.#a.has(e)&&console.warn(`[OlController] A layer named "${e}" already exists, the old layer will be replaced by the new layer. If that's what you're doing, ignore this warning.`);const r=o(t,a,s);this.#a.set(e,r),this.#t.addLayer(r)}else console.warn("[OlController] The map instance has already disposed.")}removeLayer(e){void 0===e?(this.#a.forEach((e=>{e.dispose()})),this.#a.clear()):(this.#a.get(e)?.dispose(),this.#a.delete(e))}#s=new Map;get animationLayers(){return[...this.#s.keys()]}addAnimation(e,t,a,s=1e5,r,o){if(this.#t){this.#s.has(e)&&console.warn(`[OlController] A layer named "${e}" already exists, the old layer will be replaced by the new layer. If that's what you're doing, ignore this warning.`);const i=new l(this.#t,t,a,s,r,o);this.#s.set(e,i)}else console.warn("[OlController] The map instance has already disposed.")}getAnimation(e){return this.#s.get(e)??null}removeAnimation(e){void 0===e?(this.#s.forEach((e=>{e.dispose()})),this.#s.clear()):(this.#s.get(e)?.dispose(),this.#s.delete(e))}#r=new Map;get popupOverlays(){return[...this.#r.keys()]}addPopup(e,t,a,s){if(this.#t){this.#r.has(e)&&console.warn(`[OlController] A layer named "${e}" already exists, the old layer will be replaced by the new layer. If that's what you're doing, ignore this warning.`);const r=new i(t,this.#t,a,s);this.#r.set(e,r)}else console.warn("[OlController] The map instance has already disposed.")}getPopup(e){return this.#r.get(e)??null}removePopup(e){void 0===e?(this.#r.forEach((e=>{e.dispose()})),this.#r.clear()):(this.#r.get(e)?.dispose(),this.#r.delete(e))}animateTo(e,t=1500){this.#t?.getView().animate({center:e,duration:t})}cleanUp(){this.removeLayer(),this.removeAnimation()}dispose(){this.cleanUp(),this.#t?.dispose(),this.#t=null,this.#e=null}}export{p as OlController};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbIi4uL2xpYi9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6W251bGxdLCJuYW1lcyI6WyJPbENvbnRyb2xsZXIiLCJkb20iLCJ0aGlzIiwibWFwIiwiaW5zdGFudGlhdGVkIiwiZW5hYmxlX3NlbGVjdF9saXN0ZW5lciIsInNpbmdsZUNsaWNrIiwiU2VsZWN0Iiwib24iLCJldiIsIml0ZW0iLCJ0YXJnZXQiLCJnZXRGZWF0dXJlcyIsImdldEFycmF5IiwiY29vcmRpbmF0ZSIsImdldFRvcFJpZ2h0IiwiZ2V0R2VvbWV0cnkiLCJnZXRFeHRlbnQiLCJnZXRQcm9wZXJ0aWVzIiwiX2NsaWNrX2NhbGxiYWNrIiwiY2xlYXIiLCJhZGRJbnRlcmFjdGlvbiIsImNvbnN0cnVjdG9yIiwiZWwiLCJpbml0T3B0aW9ucyIsImNyZWF0ZV90aWxlX21hcF9feHl6IiwicmVuZGVyIiwiY29uc29sZSIsIndhcm4iLCJkaXNwb3NlIiwiem9vbSIsInRvIiwidmlldyIsImdldFZpZXciLCJjdXJyX2xldmVsIiwiZ2V0Wm9vbSIsInNldFpvb20iLCJnZXRab29tTGV2ZWwiLCJzZWFyY2hJbkxheWVyIiwibGF5ZXJOYW1lIiwiY29uZGl0aW9uIiwibGF5ZXIiLCJsYXllcnMiLCJnZXQiLCJmZWF0dXJlcyIsImdldFNvdXJjZSIsImkiLCJsZW5ndGgiLCJzZWxmIiwiZXh0RGF0YSIsInRvZ2dsZV92aXNpYmxlIiwidGFyZ2V0X2xheWVyIiwic2V0VmlzaWJsZSIsImdldFZpc2libGUiLCJNYXAiLCJrZXlzIiwiZ2V0TGF5ZXIiLCJhZGRQb2ludExheWVyIiwicG9pbnRzIiwiaWNvbiIsImNsaWNrQ0IiLCJoYXMiLCJsYXllcl9wb2ludCIsImNyZWF0ZV9wb2ludF9sYXllciIsInNldCIsImFkZExheWVyIiwiYWRkUG9pbnRDbHVzdGVyTGF5ZXIiLCJkaXN0YW5jZSIsIm1pbkRpc3RhbmNlIiwiY2x1c3RlclN0eWxlIiwibGF5ZXJfcG9pbnRfY2x1c3RlciIsImNyZWF0ZV9wb2ludF9jbHVzdGVyX2xheWVyIiwiYWRkUG9seWdvbkxheWVyIiwicG9seWdvbnMiLCJzdHlsZSIsImxheWVyX2pzb24iLCJjcmVhdGVfcG9seWdvbl9sYXllcl9fR2VvSnNvbiIsImxheWVyX3BhdGgiLCJjcmVhdGVfcG9seWdvbl9sYXllcl9fUGF0aEFycmF5IiwiYWRkUG9seWxpbmVMYXllciIsInBvbHlsaW5lcyIsImxheWVyX3BvbHlsaW5lIiwiY3JlYXRlX3BvbHlsaW5lX2xheWVyIiwicmVtb3ZlTGF5ZXIiLCJ1bmRlZmluZWQiLCJmb3JFYWNoIiwidmVjTGF5ZXIiLCJkZWxldGUiLCJhbmltYXRpb25MYXllcnMiLCJhZGRBbmltYXRpb24iLCJwYXRoIiwiaWNvbnMiLCJkdXJhdGlvbiIsInBlcmNlbnRVcGRhdGVDQiIsImFuaW1hdGlvbl9jb250cm9sbGVyIiwiQW5pbWF0aW9uQ29udHJvbGxlciIsImdldEFuaW1hdGlvbiIsInJlbW92ZUFuaW1hdGlvbiIsImNvbnRyb2xsZXIiLCJwb3B1cE92ZXJsYXlzIiwiYWRkUG9wdXAiLCJhbmNob3IiLCJvZmZzZXQiLCJwb3B1cF9jb250cm9sbGVyIiwiUG9wdXBDb250cm9sbGVyIiwiZ2V0UG9wdXAiLCJyZW1vdmVQb3B1cCIsImFuaW1hdGVUbyIsImNlbnRlciIsImFuaW1hdGUiLCJjbGVhblVwIl0sIm1hcHBpbmdzIjoid25CQXNCQSxNQUFNQSxFQUtGQyxHQUlJQSxVQUNBLE9BQU9DLE1BQUtELEVBTWhCRSxHQUFxQixLQUlqQkEsVUFDQSxPQUFPRCxNQUFLQyxFQU1aQyxtQkFDQSxPQUFxQixPQUFkRixNQUFLQyxFQU9SRSx5QkFDSixNQUFNQyxFQUFjLElBQUlDLEVBQ3hCRCxFQUFZRSxHQUFHLFVBQVdDLElBQ3RCLE1BQU1DLEVBQU9ELEVBQUdFLFFBQVFDLGVBQWVDLGFBQWEsR0FDcEQsR0FBS0gsRUFBTSxDQUNQLE1BQU1JLEVBQWFDLEVBQVlMLEVBQUtNLGNBQWNDLGFBRWxEUCxFQUFLUSxnQkFBZ0JDLGtC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
